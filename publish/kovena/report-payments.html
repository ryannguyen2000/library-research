<html>
	<head>
		<link
			rel="stylesheet"
			href="https://staging-extranet-api.kovena-v2.whl-staging.com/assets/css/widgets/widget.css"
		/>
        <link rel="stylesheet" href="https://extranet-api.kovena.com/assets/css/widgets/widget.css"/>

	</head>
	<body>
		<div id="DisbursementReport"></div>

		<script type="text/javascript">
			(document => {
				const public_key = 'e4ea09c482d758c4c42cd60351e2261e';

				let script_src = 'https://staging-extranet-api.kovena-v2.whl-staging.com/assets/js/widget.min.js';
				let script = document.createElement('script');
				const url_api = 'https://staging-extranet-api.kovena-v2.whl-staging.com/api/v1/';

				const data = {
					public_key: public_key,
					merchant_ids: [],
				};

				const DisbursementReportElement = document.getElementById('DisbursementReport');

				const getAccessToken = () => {
					return new Promise(resolve => {
						fetch(`${url_api}embed/accessToken`, {
							method: 'POST',
							body: JSON.stringify(data),
							headers: {
								'Content-Type': 'application/json',
							},
						}).then(response => {
							response.json().then(results => {
								resolve(results);
							});
						});
					});
				};

				let initReports = () => {
					const handleStartDisbursementReport = () => {
						DisbursementReport.start({
							DisbursementReportElement: DisbursementReportElement,
							url_api: url_api,
							formatDate: 'DD/MM/YYYY',
							labels: {
								'Payout Date': 'Payout Date',
								Fee: 'Charge Fee',
								'Disbursement Amount': 'Disbursement Amount',
								'Guest Name': 'Guest Name',
								'Reference No': 'Reference No.',
							},
						});
					};

					handleStartDisbursementReport();

					getAccessToken().then(response => {
						kovena.access_token = response?.access_token;
						kovena.merchants = response?.merchants;

						handleStartDisbursementReport();

						setInterval(() => {
							getAccessToken().then(response => {
								kovena.access_token = response?.access_token;
								kovena.merchants = response?.merchants;
							});
						}, 3600000);
					});
				};

				script.onload = () => initReports();
				script.async = true;
				script.src = script_src;

				document.body.appendChild(script);
			})(document);
		</script>
	</body>
</html>
